"use strict";const{app:i,BrowserWindow:m,ipcMain:s,dialog:P}=require("electron"),u=require("path");require("url");const w=require("fs"),g=!i.isPackaged;let e,f;function S(){f=new m({width:600,height:400,transparent:!0,frame:!1,alwaysOnTop:!0,resizable:!1,webPreferences:{nodeIntegration:!1,contextIsolation:!0}});const t=g?`file://${u.join(__dirname,"../public/splash.html")}`:`file://${u.join(__dirname,"../public/splash.html")}`;f.loadURL(t)}function p(){e=new m({width:1600,height:900,minWidth:1280,minHeight:720,frame:!1,backgroundColor:"#1a1a2e",show:!1,webPreferences:{preload:u.join(__dirname,"preload.js"),nodeIntegration:!1,contextIsolation:!0,enableRemoteModule:!1,sandbox:!1,webSecurity:!0}});const t=g?"http://localhost:5173":`file://${u.join(__dirname,"../dist/index.html")}`;console.log("[Electron] Loading:",t),e.loadURL(t),e.webContents.on("did-fail-load",(a,o,r)=>{console.error("[Electron] Failed to load:",o,r)}),e.webContents.on("did-finish-load",()=>{console.log("[Electron] Page loaded successfully")}),e.once("ready-to-show",()=>{setTimeout(()=>{f&&!f.isDestroyed()&&f.close(),e.show(),e.focus()},2e3)}),g&&e.webContents.openDevTools(),e.on("closed",()=>{e=null})}i.whenReady().then(()=>{S(),setTimeout(p,500)});i.on("window-all-closed",()=>{process.platform!=="darwin"&&i.quit()});i.on("activate",()=>{m.getAllWindows().length===0&&p()});s.on("window-minimize",()=>{e&&e.minimize()});s.on("window-maximize",()=>{e&&(e.isMaximized()?e.unmaximize():e.maximize())});s.on("window-close",()=>{e&&e.close()});s.handle("get-app-path",async(t,a)=>i.getPath(a));s.handle("read-config",async()=>{try{const t=u.join(i.getPath("userData"),"config.json");if(w.existsSync(t))return JSON.parse(w.readFileSync(t,"utf8"))}catch(t){console.error("[Config] Error reading:",t)}return null});s.handle("save-config",async(t,a)=>{try{const o=u.join(i.getPath("userData"),"config.json");return w.writeFileSync(o,JSON.stringify(a,null,2)),{success:!0}}catch(o){return{success:!1,error:o.message}}});s.handle("select-directory",async()=>{const t=await P.showOpenDialog(e,{properties:["openDirectory"]});return t.canceled?null:t.filePaths[0]});s.handle("fetch-url",async(t,a)=>{const{net:o}=require("electron");return new Promise((r,h)=>{const c=o.request({url:a,method:"GET"});c.on("response",n=>{let l="";n.on("data",d=>{l+=d.toString()}),n.on("end",()=>{if(n.statusCode===200)try{r({success:!0,data:JSON.parse(l),raw:l})}catch{r({success:!0,data:null,raw:l})}else r({success:!1,error:`Status ${n.statusCode}`})})}),c.on("error",h),c.end()})});s.handle("fetch-image-base64",async(t,a)=>{const{net:o}=require("electron");return new Promise((r,h)=>{const c=o.request({url:a,method:"GET"});c.on("response",n=>{const l=[];n.on("data",d=>{l.push(d)}),n.on("end",()=>{if(n.statusCode===200){const d=Buffer.concat(l),y=d.toString("base64"),b=n.headers["content-type"]||"image/png";r({success:!0,dataUrl:`data:${b};base64,${y}`,size:d.length})}else r({success:!1,error:`Status ${n.statusCode}`})})}),c.on("error",h),c.end()})});console.log("[Electron] Main process started");
